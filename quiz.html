<!DOCTYPE html>
<html>
<head>
  <title>Quiz</title>
</head>
<body>

<h2 id="question">Waiting for question...</h2>
<div id="options"></div>
<p>Your Score: <span id="score">0</span></p>

<script src="data.js"></script>
<script>
let score = 0;
let answered = false;

/* ‚ùå Prevent repeat participation */
if (localStorage.getItem("played") === "yes") {
  document.body.innerHTML = "<h2>You already participated on this device</h2>";
}

/* Load question from admin */
window.addEventListener("storage", () => {
  loadQuestion();
});

function loadQuestion() {
  const qIndex = localStorage.getItem("currentQuestion");
  if (qIndex === null) return;

  answered = false;
  const q = questions[qIndex];
  document.getElementById("question").innerText = q.q;

  let optHTML = "";
  q.options.forEach((opt, i) => {
    optHTML += `<button onclick="answer(${i})">${opt}</button><br>`;
  });
  document.getElementById("options").innerHTML = optHTML;
}

function answer(choice) {
  if (answered) return;
  answered = true;

  const qIndex = localStorage.getItem("currentQuestion");
  if (choice == questions[qIndex].answer) {
    score++;
    document.getElementById("score").innerText = score;
  }

  localStorage.setItem("playerScore", score);
  localStorage.setItem("played", "yes");
}

loadQuestion();
</script>

</body>
</html>
